<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>jvm tool笔记 | Willis's Note</title><link rel="stylesheet" type="text/css" href="/willis-blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/willis-blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/willis-blog/favicon.ico"><link rel="apple-touch-icon" href="/willis-blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/willis-blog/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">jvm tool笔记</h1><a id="logo" href="/willis-blog/.">Willis's Note</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/willis-blog/."><i class="fa fa-home"> 首页</i></a><a href="/willis-blog/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/willis-blog/about/"><i class="fa fa-user"> 关于</i></a><a href="/willis-blog/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">jvm tool笔记</h1><div class="post-meta">2019-02-26<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="常用JVM工具"><a href="#常用JVM工具" class="headerlink" title="常用JVM工具"></a>常用JVM工具</h2><h3 id="jps进程状况命令"><a href="#jps进程状况命令" class="headerlink" title="jps进程状况命令"></a>jps进程状况命令</h3><p><strong><em>shell（windows下cmd）直接输入jps，可以列出所有jvm进程，如下</em></strong></p>
<p><img src="/willis-blog/images/2019-02-25/jps-1.png" alt="jps"></p>
<p><strong><em>jps -h可以查看可用参数，如下</em></strong></p>
<p><img src="/willis-blog/images/2019-02-25/jps-2.png" alt="jps"></p>
<p>如图可见，参数可以是</p>
<table>
<thead>
<tr>
<th align="right">参数</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right">-q</td>
<td align="left">只打印进程ID，别的不输出</td>
</tr>
<tr>
<td align="right">-m</td>
<td align="left">输出虚拟机启动时传给主类main（）函数的参数</td>
</tr>
<tr>
<td align="right">-l</td>
<td align="left">输出进程id和类的全名。如果执行的是jar包，则输出jar包路径</td>
</tr>
<tr>
<td align="right">-v</td>
<td align="left">输出虚拟机启动时的jvm参数</td>
</tr>
</tbody></table>
<h3 id="jstat虚拟机统计信息监控工具"><a href="#jstat虚拟机统计信息监控工具" class="headerlink" title="jstat虚拟机统计信息监控工具"></a>jstat虚拟机统计信息监控工具</h3><p><strong>可以显示本地或者远程虚拟机进程的类装载、内存、垃圾收集、JIT编译等运行数据</strong></p>
<p><strong><em>使用方法</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat [option vmid [interval[s|ms] [count]]]</span><br></pre></td></tr></table></figure>

<p>其中，<strong>vmid</strong>就是进程ID。<strong>interval</strong>值得是监控间隔的时间，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc 123 300</span><br></pre></td></tr></table></figure>
<p>则每300ms打印一次进程123的gc情况。<strong>count</strong>是查询的次数，如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -gc 123 300 10</span><br></pre></td></tr></table></figure>
<p>则每300ms打印一次进程123的gc情况，打印10次退出。</p>
<p><em>option选项可参考</em></p>
<table>
<thead>
<tr>
<th align="right">option</th>
<th align="left">description</th>
</tr>
</thead>
<tbody><tr>
<td align="right">-class</td>
<td align="left">监视类装载、卸载数量、总空间以及类装载所耗费的时间</td>
</tr>
<tr>
<td align="right">-gc</td>
<td align="left">监视Java堆状况，包括Eden区、2个Survivor区、老年代、永久代等的容量</td>
</tr>
<tr>
<td align="right">-gccapacity</td>
<td align="left">监视内容与-gc基本相同，但输出主要关注Java堆各个区域使用到的最大和最小空间</td>
</tr>
<tr>
<td align="right">-gcutil</td>
<td align="left">监视内容与-gc基本相同，但输出主要关注已使用空间占总空间的百分比 (这是博主在性能监控中最常用的选项)</td>
</tr>
<tr>
<td align="right">-gccause</td>
<td align="left">与-gcutil功能一样，但是会额外输出导致上一次GC产生的原因</td>
</tr>
<tr>
<td align="right">-gcnew</td>
<td align="left">监视新生代GC的状况</td>
</tr>
<tr>
<td align="right">-gcnewcapacity</td>
<td align="left">监视内容与-gcnew基本相同，输出主要关注使用到的最大和最小空间</td>
</tr>
<tr>
<td align="right">-gcold</td>
<td align="left">监视老年代GC的状况</td>
</tr>
<tr>
<td align="right">-gcoldcapacity</td>
<td align="left">监视内容与——gcold基本相同，输出主要关注使用到的最大和最小空间</td>
</tr>
<tr>
<td align="right">-gcpermcapacity</td>
<td align="left">输出永久代使用到的最大和最小空间</td>
</tr>
<tr>
<td align="right">-compiler</td>
<td align="left">输出JIT编译器编译过的方法、耗时等信息</td>
</tr>
<tr>
<td align="right">-printcompilation</td>
<td align="left">输出已经被JIT编译的方法</td>
</tr>
</tbody></table>
<p><strong><em>例如</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jstat -gcutil 21760</span></span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">  0.00   0.00  18.01   0.62      -      -   1914    0.873     0    0.000    0.873</span><br></pre></td></tr></table></figure>

<p>上面代码表示，Eden区使用了18.1%的空间。两个survivor都是空的，老年代用了0.62%的空间，Metaspace没有打印（不知道为啥）。young gc发生了1914次，总耗时0.873秒。Full gc发生0次，总耗时0.000秒</p>


<h3 id="jmap-JVM内存映像工具"><a href="#jmap-JVM内存映像工具" class="headerlink" title="jmap JVM内存映像工具"></a>jmap JVM内存映像工具</h3><p><strong><em>使用方法</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap [option] vmid</span><br></pre></td></tr></table></figure>
<p><em>option如下</em></p>
<table>
<thead>
<tr>
<th align="right">option</th>
<th align="left">description</th>
</tr>
</thead>
<tbody><tr>
<td align="right">-dump[:live,]format=b,file=&lt;<u>filename</u>&gt;</td>
<td align="left">Dumps the Java heap in hprof binary format to filename. The live suboption is optional. If specified, only the live objects in the heap are dumped. To browse the heap dump, you can use jhat (Java Heap Analysis Tool) to read the generated file.</td>
</tr>
<tr>
<td align="right">-finalizerinfo</td>
<td align="left">Prints information on objects awaiting finalization.<strong><em>only make sence on linux/solaris</em></strong></td>
</tr>
<tr>
<td align="right">-heap</td>
<td align="left">Prints a heap summary. GC algorithm used, heap configuration and generation wise heap usage are printed.<strong><em>only make sence on linux/solaris</em></strong></td>
</tr>
<tr>
<td align="right">-histo[:live]</td>
<td align="left">Prints a histogram of the heap. For each Java class, number of objects, memory size in bytes, and fully qualified class names are printed. VM internal class names are printed with ‘*’ prefix. If the live suboption is specified, only live objects are counted.</td>
</tr>
<tr>
<td align="right">-permstat</td>
<td align="left">Prints class loader wise statistics of permanent generation of Java heap. For each class loader, its name, liveness, address, parent class loader, and the number and size of classes it has loaded are printed. In addition, the number and size of interned Strings are printed.<strong><em>only make sence on linux/solaris</em></strong></td>
</tr>
<tr>
<td align="right">-F</td>
<td align="left">Force. Use with jmap -dump or jmap -histo option if the pid does not respond. The live suboption is not supported in this mode.</td>
</tr>
</tbody></table>
<p><strong><em>例如</em></strong><br><em>1、生成dump快照</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jmap -dump:format=b,file=java_21760.hprof 21760</span></span><br><span class="line">Dumping heap to E:\workspace\docs\blog\java_21760.hprof ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure>

<p>类似的，在启动参数中，通过如下参数可以再发生内存溢出时自动dump</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/path</span><br></pre></td></tr></table></figure>

<p><em>2、显示堆中对象的统计信息，包括类、实例数、所占内存</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jmap -histo:live 21760</span>                                                                   </span><br><span class="line">                                                                                           </span><br><span class="line"> num     #instances         #bytes  class name                                             </span><br><span class="line">----------------------------------------------                                             </span><br><span class="line">   1:          6135         790960  &lt;methodKlass&gt;                                          </span><br><span class="line">   2:          6135         709944  &lt;constMethodKlass&gt;                                     </span><br><span class="line">   3:           415         494456  &lt;constantPoolKlass&gt;                                    </span><br><span class="line">   4:           379         299840  &lt;constantPoolCacheKlass&gt;                               </span><br><span class="line">   5:           415         284552  &lt;instanceKlassKlass&gt;                                   </span><br><span class="line">   6:          2023         278856  [C                                                     </span><br><span class="line">   7:           582          95392  [B                                                     </span><br><span class="line">   8:           477          46680  java.lang.Class                                        </span><br><span class="line">   9:          1870          44880  java.lang.String                                       </span><br><span class="line">  10:           675          44408  [[I                                                    </span><br><span class="line">  11:           633          38544  [S                                                     </span><br><span class="line">  12:           420          33664  [I                                                     </span><br><span class="line">  13:           785          31400  java.util.TreeMap$Entry                                </span><br><span class="line">  14:            68          25840  &lt;methodDataKlass&gt;                                      </span><br><span class="line">  15:            45          24480  &lt;objArrayKlassKlass&gt;                                   </span><br><span class="line">  16:           325          14280  [Ljava.lang.Object;                                    </span><br><span class="line">  17:           189           7696  [Ljava.lang.String;                                    </span><br><span class="line">  18:             8           4352  &lt;typeArrayKlassKlass&gt;                                  </span><br><span class="line">  19:            97           3880  java.lang.ref.SoftReference                            </span><br><span class="line">  20:           117           3744  java.util.Hashtable$Entry                              </span><br><span class="line">  21:            57           3648  java.net.URL                                           </span><br><span class="line">  22:            11           2288  &lt;klassKlass&gt;                                           </span><br><span class="line">  23:            61           1952  java.util.concurrent.ConcurrentHashMap$HashEntry       </span><br><span class="line">  24:            48           1920  java.util.concurrent.ConcurrentHashMap$Segment         </span><br><span class="line">  25:            38           1824  sun.util.locale.LocaleObjectCache$CacheEntry           </span><br><span class="line">  26:            48           1536  java.util.concurrent.locks.ReentrantLock$NonfairSync   </span><br><span class="line">  27:            46           1472  java.util.HashMap$Entry                                </span><br><span class="line">  28:            48           1296  [Ljava.util.concurrent.ConcurrentHashMap$HashEntry;    </span><br><span class="line">  29:            27           1296  sun.misc.URLClassPath$JarLoader                        </span><br><span class="line">  30:            18           1296  java.lang.reflect.Constructor                          </span><br><span class="line">  31:            32           1280  java.util.LinkedHashMap$Entry                          </span><br><span class="line">  32:            14           1120  [Ljava.util.WeakHashMap$Entry;                         </span><br><span class="line">  33:            13           1104  [Ljava.util.HashMap$Entry;                             </span><br><span class="line">  34:             7           1056  [Ljava.util.Hashtable$Entry;                           </span><br><span class="line">  35:             1           1040  [[C                                                    </span><br><span class="line">  36:             9            936  java.lang.Thread                                       </span><br><span class="line">  37:            17            816  java.util.HashMap                                      </span><br><span class="line">  38:            14            784  java.util.WeakHashMap                                  </span><br><span class="line">  39:            19            760  java.io.ObjectStreamField                              </span><br><span class="line">  40:            19            760  sun.util.locale.BaseLocale$Key                         </span><br><span class="line">  41:            46            736  java.lang.Object                                       </span><br><span class="line">  42:            30            720  java.io.ExpiringCache$Entry                            </span><br><span class="line">  43:            11            704  java.util.jar.JarFile                                  </span><br><span class="line">  44:            16            640  java.lang.ref.Finalizer                                </span><br><span class="line">  45:             8            640  [Ljava.util.concurrent.ConcurrentHashMap$Segment;      </span><br><span class="line">  46:            13            624  sun.nio.cs.UTF_8$Encoder                               </span><br><span class="line">  47:            19            608  sun.util.locale.BaseLocale                             </span><br><span class="line">  48:            18            576  java.lang.ref.ReferenceQueue                           </span><br><span class="line">  49:             7            560  java.util.jar.JarFile$JarFileEntry                     </span><br><span class="line">  50:            19            456  java.util.Locale                                       </span><br><span class="line">  51:            19            456  java.util.Locale$LocaleKey                             </span><br><span class="line">  52:            13            416  java.security.AccessControlContext                     </span><br><span class="line">  53:             8            384  java.util.concurrent.ConcurrentHashMap                 </span><br><span class="line">  54:             6            384  java.nio.DirectByteBuffer                              </span><br><span class="line">  55:            11            352  java.util.zip.ZipCoder                                 </span><br><span class="line">  56:             6            336  java.nio.DirectLongBufferU                             </span><br><span class="line">  57:            20            320  java.lang.ref.ReferenceQueue$Lock                      </span><br><span class="line">  58:             9            288  java.io.File                                           </span><br><span class="line">  59:            11            264  java.util.ArrayDeque                                   </span><br><span class="line">  60:             8            256  java.lang.OutOfMemoryError                             </span><br><span class="line">  61:             9            240  [Ljava.io.ObjectStreamField;                           </span><br><span class="line">  62:             9            216  sun.reflect.NativeConstructorAccessorImpl              </span><br><span class="line">  63:             5            200  java.util.WeakHashMap$Entry                            </span><br><span class="line">  64:             4            192  java.util.Hashtable                                    </span><br><span class="line">  65:             4            192  java.util.TreeMap                                      </span><br><span class="line">  66:             8            192  sun.misc.MetaIndex                                     </span><br><span class="line">  67:             6            192  java.util.Vector                                       </span><br><span class="line">  68:            11            184  [Ljava.lang.Class;                                     </span><br><span class="line">  69:             3            168  java.util.Properties                                   </span><br><span class="line">  70:             2            160  [Ljava.lang.ThreadLocal$ThreadLocalMap$Entry;          </span><br><span class="line">  71:             9            144  sun.reflect.DelegatingConstructorAccessorImpl          </span><br><span class="line">  72:             6            144  sun.misc.PerfCounter                                   </span><br><span class="line">  73:             6            144  java.util.ArrayList                                    </span><br><span class="line">  74:             2            128  java.io.ExpiringCache$1                                </span><br><span class="line">  75:             4            128  java.lang.ThreadLocal$ThreadLocalMap$Entry             </span><br><span class="line">  76:             3            120  java.security.ProtectionDomain                         </span><br><span class="line">  77:             1            112  java.lang.ref.Finalizer$FinalizerThread                </span><br><span class="line">  78:             2            112  sun.nio.cs.StreamEncoder                               </span><br><span class="line">  79:             1            104  java.util.concurrent.ThreadLocalRandom                 </span><br><span class="line">  80:             1            104  java.lang.ref.Reference$ReferenceHandler               </span><br><span class="line">  81:             3             96  java.io.FileDescriptor                                 </span><br><span class="line">  82:             3             96  java.security.CodeSource                               </span><br><span class="line">  83:             2             96  java.lang.ThreadGroup                                  </span><br><span class="line">  84:             2             96  java.nio.HeapByteBuffer                                </span><br><span class="line">  85:             2             96  java.io.BufferedWriter                                 </span><br><span class="line">  86:             3             96  java.util.Stack                                        </span><br><span class="line">  87:             2             80  sun.misc.URLClassPath                                  </span><br><span class="line">  88:             1             80  sun.misc.Launcher$ExtClassLoader                       </span><br><span class="line">  89:             2             80  java.io.ExpiringCache                                  </span><br><span class="line">  90:             1             80  sun.misc.Launcher$AppClassLoader                       </span><br><span class="line">  91:             5             80  java.lang.ThreadLocal                                  </span><br><span class="line">  92:             3             72  java.util.Collections$SynchronizedSet                  </span><br><span class="line">  93:             3             72  java.lang.RuntimePermission                            </span><br><span class="line">  94:             3             72  java.util.concurrent.atomic.AtomicLong                 </span><br><span class="line">  95:             2             64  java.io.FileOutputStream                               </span><br><span class="line">  96:             2             64  java.lang.VirtualMachineError                          </span><br><span class="line">  97:             2             64  java.io.PrintStream                                    </span><br><span class="line">  98:             2             64  [Ljava.lang.Thread;                                    </span><br><span class="line">  99:             4             64  java.util.concurrent.atomic.AtomicInteger              </span><br><span class="line"> 100:             2             64  java.io.OutputStreamWriter                             </span><br><span class="line"> 101:             2             64  java.lang.ref.ReferenceQueue$Null                      </span><br><span class="line"> 102:             1             56  java.lang.Package                                      </span><br><span class="line"> 103:             3             48  java.security.ProtectionDomain$Key                     </span><br><span class="line"> 104:             2             48  sun.misc.NativeSignalHandler                           </span><br><span class="line"> 105:             2             48  java.nio.charset.CoderResult                           </span><br><span class="line"> 106:             2             48  sun.misc.Signal                                        </span><br><span class="line"> 107:             2             48  java.io.BufferedOutputStream                           </span><br><span class="line"> 108:             1             48  java.util.zip.Inflater                                 </span><br><span class="line"> 109:             2             48  java.io.File$PathStatus                                </span><br><span class="line"> 110:             1             48  [J                                                     </span><br><span class="line"> 111:             3             48  java.nio.charset.CodingErrorAction                     </span><br><span class="line"> 112:             2             48  java.lang.ThreadLocal$ThreadLocalMap                   </span><br><span class="line"> 113:             3             48  [Ljava.security.Principal;                             </span><br><span class="line"> 114:             1             40  java.io.BufferedInputStream                            </span><br><span class="line"> 115:             1             40  sun.nio.cs.ext.ExtendedCharsets                        </span><br><span class="line"> 116:             1             40  sun.nio.cs.StandardCharsets$Aliases                    </span><br><span class="line"> 117:             1             40  sun.nio.cs.StandardCharsets$Cache                      </span><br><span class="line"> 118:             1             40  sun.nio.cs.StandardCharsets$Classes                    </span><br><span class="line"> 119:             1             32  java.lang.ArithmeticException                          </span><br><span class="line"> 120:             1             32  java.lang.NullPointerException                         </span><br><span class="line"> 121:             2             32  java.lang.Boolean                                      </span><br><span class="line"> 122:             1             32  java.io.FileInputStream                                </span><br><span class="line"> 123:             1             32  java.lang.ClassLoader$NativeLibrary                    </span><br><span class="line"> 124:             2             32  java.lang.Integer                                      </span><br><span class="line"> 125:             1             32  [Ljava.lang.ThreadGroup;                               </span><br><span class="line"> 126:             1             32  [Ljava.lang.OutOfMemoryError;                          </span><br><span class="line"> 127:             1             32  sun.nio.cs.StandardCharsets                            </span><br><span class="line"> 128:             1             32  java.io.FilePermission                                 </span><br><span class="line"> 129:             2             32  java.nio.ByteOrder                                     </span><br><span class="line"> 130:             2             32  sun.net.www.protocol.jar.Handler                       </span><br><span class="line"> 131:             1             32  java.security.Permissions                              </span><br><span class="line"> 132:             1             32  java.io.WinNTFileSystem                                </span><br><span class="line"> 133:             2             32  [Ljava.lang.StackTraceElement;                         </span><br><span class="line"> 134:             1             32  java.security.BasicPermissionCollection                </span><br><span class="line"> 135:             1             32  java.lang.reflect.WeakCache                            </span><br><span class="line"> 136:             1             32  java.util.concurrent.atomic.AtomicReferenceFieldUpdater</span><br><span class="line"> 137:             2             32  java.util.HashSet                                      </span><br><span class="line"> 138:             1             24  java.lang.reflect.ReflectPermission                    </span><br><span class="line"> 139:             1             24  sun.nio.cs.ISO_8859_1                                  </span><br><span class="line"> 140:             1             24  java.util.Collections$UnmodifiableRandomAccessList     </span><br><span class="line"> 141:             1             24  sun.misc.URLClassPath$FileLoader                       </span><br><span class="line"> 142:             1             24  java.util.Collections$EmptyMap                         </span><br><span class="line"> 143:             1             24  sun.nio.cs.UTF_16                                      </span><br><span class="line"> 144:             1             24  java.io.FilePermissionCollection                       </span><br><span class="line"> 145:             1             24  sun.util.locale.BaseLocale$Cache                       </span><br><span class="line"> 146:             1             24  java.util.Locale$Cache                                 </span><br><span class="line"> 147:             1             24  java.util.BitSet                                       </span><br><span class="line"> 148:             1             24  java.util.zip.ZStreamRef                               </span><br><span class="line"> 149:             1             24  sun.nio.cs.UTF_16BE                                    </span><br><span class="line"> 150:             1             24  sun.nio.cs.UTF_16LE                                    </span><br><span class="line"> 151:             1             24  [Ljava.io.File$PathStatus;                             </span><br><span class="line"> 152:             1             24  sun.nio.cs.US_ASCII                                    </span><br><span class="line"> 153:             1             24  [Lsun.launcher.LauncherHelper;                         </span><br><span class="line"> 154:             1             24  sun.launcher.LauncherHelper                            </span><br><span class="line"> 155:             1             24  java.util.Collections$SetFromMap                       </span><br><span class="line"> 156:             1             24  sun.nio.cs.UTF_8                                       </span><br><span class="line"> 157:             1             24  java.lang.StringBuilder                                </span><br><span class="line"> 158:             1             16  [Ljava.security.cert.Certificate;                      </span><br><span class="line"> 159:             1             16  sun.misc.Perf                                          </span><br><span class="line"> 160:             1             16  sun.misc.Launcher                                      </span><br><span class="line"> 161:             1             16  java.lang.reflect.Proxy$ProxyClassFactory              </span><br><span class="line"> 162:             1             16  [Ljava.lang.Throwable;                                 </span><br><span class="line"> 163:             1             16  java.util.concurrent.ThreadLocalRandom$1               </span><br><span class="line"> 164:             1             16  java.lang.reflect.Proxy$KeyFactory                     </span><br><span class="line"> 165:             1             16  sun.misc.ASCIICaseInsensitiveComparator                </span><br><span class="line"> 166:             1             16  java.lang.System$2                                     </span><br><span class="line"> 167:             1             16  sun.net.www.protocol.file.Handler                      </span><br><span class="line"> 168:             1             16  sun.misc.Launcher$Factory                              </span><br><span class="line"> 169:             1             16  java.lang.ref.Reference$Lock                           </span><br><span class="line"> 170:             1             16  java.lang.CharacterDataLatin1                          </span><br><span class="line"> 171:             1             16  java.nio.Bits$1                                        </span><br><span class="line"> 172:             1             16  sun.misc.Unsafe                                        </span><br><span class="line"> 173:             1             16  java.lang.reflect.ReflectAccess                        </span><br><span class="line"> 174:             1             16  sun.reflect.ReflectionFactory                          </span><br><span class="line"> 175:             1             16  java.nio.charset.CoderResult$1                         </span><br><span class="line"> 176:             1             16  java.lang.Runtime                                      </span><br><span class="line"> 177:             1             16  java.util.Collections$EmptyList                        </span><br><span class="line"> 178:             1             16  java.util.WeakHashMap$KeySet                           </span><br><span class="line"> 179:             1             16  java.nio.charset.CoderResult$2                         </span><br><span class="line"> 180:             1             16  java.security.ProtectionDomain$1                       </span><br><span class="line"> 181:             1             16  java.lang.Terminator$1                                 </span><br><span class="line"> 182:             1             16  java.util.Collections$EmptySet                         </span><br><span class="line"> 183:             1             16  java.lang.String$CaseInsensitiveComparator             </span><br><span class="line"> 184:             1             16  java.util.Hashtable$EntrySet                           </span><br><span class="line"> 185:             1             16  java.net.URLClassLoader$7                              </span><br><span class="line"> 186:             1             16  java.io.FileDescriptor$1                               </span><br><span class="line"> 187:             1             16  java.security.ProtectionDomain$3                       </span><br><span class="line"> 188:             1             16  java.util.zip.ZipFile$2                                </span><br><span class="line"> 189:             1             16  java.util.jar.JavaUtilJarAccessImpl                    </span><br><span class="line">Total         22891        3322952                                                         </span><br></pre></td></tr></table></figure>
<p>上述结果，constMethodKlass/ methodKlass/ constantPoolKlass/ constantPoolCacheKlass/ instanceKlassKlass/ methodDataKlass与Classloader相关，常驻与Perm区。<br>instances字段代表实例数， #bytes代表占用字节数</p>
<p><strong><em>描述符</em></strong></p>
<table>
<thead>
<tr>
<th align="left">标识字符</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">B</td>
<td align="left">基本类型byte</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">基本类型char</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">基本类型double</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">基本类型float</td>
</tr>
<tr>
<td align="left">I</td>
<td align="left">基本类型int</td>
</tr>
<tr>
<td align="left">J</td>
<td align="left">基本类型long</td>
</tr>
<tr>
<td align="left">S</td>
<td align="left">基本类型short</td>
</tr>
<tr>
<td align="left">Z</td>
<td align="left">基本类型boolean</td>
</tr>
<tr>
<td align="left">V</td>
<td align="left">特殊类型void</td>
</tr>
<tr>
<td align="left">L</td>
<td align="left">对象类型。如Ljava/lang/Object</td>
</tr>
</tbody></table>
<p><u>数组描述符：一位数组用前缀”[“描述，二维数组用“[[”前缀描述；</u></p>
<p><u>方法描述符：先参数列表，后返回值类型来描述。如java.lang.String toString()的描述符就是()Ljava/lang/String;</u></p>
<h3 id="jhat快照分析工具"><a href="#jhat快照分析工具" class="headerlink" title="jhat快照分析工具"></a>jhat快照分析工具</h3><p>jhat可以分析通过jmap生成的dump文件，在本地启动一个jvm后台服务，可以通过浏览器访问的页面来查看分析结果。<br><strong><em>使用方法</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat [option] dumpfile</span><br></pre></td></tr></table></figure>
<p><strong><em>例如</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> jhat -port 7001 java_21760.hprof</span></span><br><span class="line">Reading from java_21760.hprof...</span><br><span class="line">Dump file created Tue Feb 26 00:52:07 CST 2019</span><br><span class="line">Snapshot read, resolving...</span><br><span class="line">Resolving 291942 objects...</span><br><span class="line">Chasing references, expect 58 dots..........................................................</span><br><span class="line">Eliminating duplicate references..........................................................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port 7001</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>
<p>浏览器输入<a target="_blank" rel="noopener" href="http://localhost:7001/">http://localhost:7001/</a> 如图<br><img src="/willis-blog/images/2019-02-25/jhat-1.png"></p>
<h3 id="jstatck-Java堆栈跟踪工具"><a href="#jstatck-Java堆栈跟踪工具" class="headerlink" title="jstatck Java堆栈跟踪工具"></a>jstatck Java堆栈跟踪工具</h3><p>jstack命令用于生成虚拟机当前时刻线程快照（一般称为threaddump或者javacore文件）。<strong>一般用于定位线程出现产时间停顿的原因</strong>，如死锁、死循环、请求外部资源导致长时间等待。</p>
<p><em>从JDK1.5开始，Thread类新增了一个getAllStackTrace的方法，用于获取虚拟机中所有线程的StackTraceElement对象，使用这个方法可以通过简单几行代码完成jstack的大部分功能</em></p>
<p><strong><em>使用方法</em></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack [option] vimid</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="right">选项</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="right">-F</td>
<td align="left">当正常输出的请求不被响应时，强制输出线程堆栈</td>
</tr>
<tr>
<td align="right">-l</td>
<td align="left">除堆栈外，显示关于锁的附加信息</td>
</tr>
<tr>
<td align="right">-m</td>
<td align="left">如果调用到本地方法的话，可以显示c/c++的堆栈</td>
</tr>
</tbody></table>
<p><strong><em>例如</em></strong></p>
<p><em>一个死锁的例子</em></p>
<p>线程1如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object lock1;</span><br><span class="line">    <span class="keyword">private</span> Object lock2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Thread1</span><span class="params">(Object lock1, Object lock2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lock1 = lock1;</span><br><span class="line">        <span class="keyword">this</span>.lock2 = lock2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        running();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">running</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;2号锁释放&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>线程2如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object lock1;</span><br><span class="line">    <span class="keyword">private</span> Object lock2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Thread2</span><span class="params">(Object lock1, Object lock2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lock1 = lock1;</span><br><span class="line">        <span class="keyword">this</span>.lock2 = lock2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        running();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">running</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;1号锁释放&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序入口如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object lock1 = <span class="keyword">new</span> Object();</span><br><span class="line">        Object lock2 = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Thread1(lock1, lock2));</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Thread2(lock1, lock2));</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jstack 查看堆栈信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">jstack 13768</span><br><span class="line">2019-03-04 01:04:52</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.91-b14 mixed mode):</span><br><span class="line"></span><br><span class="line">&quot;DestroyJavaVM&quot; #15 prio=5 os_prio=0 tid=0x0000000002198800 nid=0x2398 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Thread-1&quot; #14 prio=5 os_prio=0 tid=0x0000000059067000 nid=0x468 waiting for monitor entry [0x000000005a60f000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at com.thrift.test.sync.Thread2.running(Thread2.java:27)</span><br><span class="line">        - waiting to lock &lt;0x00000000d6bdfd40&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d6bdfd50&gt; (a java.lang.Object)</span><br><span class="line">        at com.thrift.test.sync.Thread2.run(Thread2.java:19)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">&quot;Thread-0&quot; #13 prio=5 os_prio=0 tid=0x0000000059064000 nid=0x2058 waiting for monitor entry [0x000000005a41f000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at com.thrift.test.sync.Thread1.running(Thread1.java:27)</span><br><span class="line">        - waiting to lock &lt;0x00000000d6bdfd50&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d6bdfd40&gt; (a java.lang.Object)</span><br><span class="line">        at com.thrift.test.sync.Thread1.run(Thread1.java:19)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">&quot;Service Thread&quot; #12 daemon prio=9 os_prio=0 tid=0x0000000058f78800 nid=0x2018 runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C1 CompilerThread2&quot; #11 daemon prio=9 os_prio=2 tid=0x0000000058f78000 nid=0x201c waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C2 CompilerThread1&quot; #10 daemon prio=9 os_prio=2 tid=0x0000000058f77000 nid=0x2028 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C2 CompilerThread0&quot; #9 daemon prio=9 os_prio=2 tid=0x0000000058f7b000 nid=0x202c waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;JDWP Command Reader&quot; #8 daemon prio=10 os_prio=0 tid=0x0000000058f62800 nid=0x204c runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;JDWP Event Helper Thread&quot; #7 daemon prio=10 os_prio=0 tid=0x0000000058f5f800 nid=0x2044 runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;JDWP Transport Listener: dt_socket&quot; #6 daemon prio=10 os_prio=0 tid=0x0000000058f5a000 nid=0x2050 runnable [0x0000000000000000</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Attach Listener&quot; #5 daemon prio=5 os_prio=2 tid=0x0000000057064800 nid=0x2010 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Signal Dispatcher&quot; #4 daemon prio=9 os_prio=2 tid=0x0000000057068800 nid=0x1a88 runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Finalizer&quot; #3 daemon prio=8 os_prio=1 tid=0x000000005704b000 nid=0x23fc in Object.wait() [0x0000000058f2f000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x00000000d6b08ee0&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)</span><br><span class="line">        - locked &lt;0x00000000d6b08ee0&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)</span><br><span class="line">        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)</span><br><span class="line"></span><br><span class="line">&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=2 tid=0x0000000057004000 nid=0x23f0 in Object.wait() [0x0000000058def000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x00000000d6b06b50&gt; (a java.lang.ref.Reference$Lock)</span><br><span class="line">        at java.lang.Object.wait(Object.java:502)</span><br><span class="line">        at java.lang.ref.Reference.tryHandlePending(Reference.java:191)</span><br><span class="line">        - locked &lt;0x00000000d6b06b50&gt; (a java.lang.ref.Reference$Lock)</span><br><span class="line">        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)</span><br><span class="line"></span><br><span class="line">&quot;VM Thread&quot; os_prio=2 tid=0x0000000056ffc000 nid=0x23ec runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread#0 (ParallelGC)&quot; os_prio=0 tid=0x00000000021ae000 nid=0x23ac runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread#1 (ParallelGC)&quot; os_prio=0 tid=0x00000000021af800 nid=0x23b0 runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread#2 (ParallelGC)&quot; os_prio=0 tid=0x00000000021b1000 nid=0x23b4 runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread#3 (ParallelGC)&quot; os_prio=0 tid=0x00000000021b3000 nid=0x23b8 runnable</span><br><span class="line"></span><br><span class="line">&quot;VM Periodic Task Thread&quot; os_prio=2 tid=0x000000005902d800 nid=0x2054 waiting on condition</span><br><span class="line"></span><br><span class="line">JNI global references: 1478</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">  waiting to lock monitor 0x000000005700a778 (object 0x00000000d6bdfd40, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-0&quot;</span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">  waiting to lock monitor 0x00000000570066d8 (object 0x00000000d6bdfd50, a java.lang.Object),</span><br><span class="line">  which is held by &quot;Thread-1&quot;</span><br><span class="line"></span><br><span class="line">Java stack information for the threads listed above:</span><br><span class="line">===================================================</span><br><span class="line">&quot;Thread-1&quot;:</span><br><span class="line">        at com.thrift.test.sync.Thread2.running(Thread2.java:27)</span><br><span class="line">        - waiting to lock &lt;0x00000000d6bdfd40&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d6bdfd50&gt; (a java.lang.Object)</span><br><span class="line">        at com.thrift.test.sync.Thread2.run(Thread2.java:19)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line">&quot;Thread-0&quot;:</span><br><span class="line">        at com.thrift.test.sync.Thread1.running(Thread1.java:27)</span><br><span class="line">        - waiting to lock &lt;0x00000000d6bdfd50&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d6bdfd40&gt; (a java.lang.Object)</span><br><span class="line">        at com.thrift.test.sync.Thread1.run(Thread1.java:19)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">Found 1 deadlock.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>参考文献<br>《深入立即Java虚拟机》第二版</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html">https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html</a> </p>
</div><div class="tags"><a href="/willis-blog/tags/jvm/"><i class="fa fa-tag"></i>jvm</a><a href="/willis-blog/tags/java/"><i class="fa fa-tag"></i>java</a></div><div class="post-nav"><a class="pre" href="/willis-blog/2019/03/05/Class-Struct/">类文件</a><a class="next" href="/willis-blog/2019/02/25/JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">JVM 内存模型</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://willis-song.gitee.io/willis-blog"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/willis-blog/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/willis-blog/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/willis-blog/tags/elastic/" style="font-size: 15px;">elastic</a> <a href="/willis-blog/tags/Dubbo/" style="font-size: 15px;">Dubbo</a> <a href="/willis-blog/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 15px;">微服务</a> <a href="/willis-blog/tags/Swarm/" style="font-size: 15px;">Swarm</a> <a href="/willis-blog/tags/%E6%B8%B8%E7%8E%A9/" style="font-size: 15px;">游玩</a> <a href="/willis-blog/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/willis-blog/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" style="font-size: 15px;">反向代理</a> <a href="/willis-blog/tags/IO/" style="font-size: 15px;">IO</a> <a href="/willis-blog/tags/%E5%90%8C%E6%AD%A5IO/" style="font-size: 15px;">同步IO</a> <a href="/willis-blog/tags/%E5%BC%82%E6%AD%A5IO/" style="font-size: 15px;">异步IO</a> <a href="/willis-blog/tags/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" style="font-size: 15px;">多路复用</a> <a href="/willis-blog/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/willis-blog/tags/Java/" style="font-size: 15px;">Java</a> <a href="/willis-blog/tags/%E6%8C%87%E9%92%88%E5%8E%8B%E7%BC%A9/" style="font-size: 15px;">指针压缩</a> <a href="/willis-blog/tags/%E5%90%8C%E6%AD%A5/" style="font-size: 15px;">同步</a> <a href="/willis-blog/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" style="font-size: 15px;">线程安全</a> <a href="/willis-blog/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/willis-blog/tags/java/" style="font-size: 15px;">java</a> <a href="/willis-blog/tags/InnoDb/" style="font-size: 15px;">InnoDb</a> <a href="/willis-blog/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 15px;">操作系统</a> <a href="/willis-blog/tags/%E7%94%A8%E6%88%B7%E6%80%81/" style="font-size: 15px;">用户态</a> <a href="/willis-blog/tags/%E6%A0%B8%E6%80%81/" style="font-size: 15px;">核态</a> <a href="/willis-blog/tags/%E7%AE%A1%E6%80%81/" style="font-size: 15px;">管态</a> <a href="/willis-blog/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15px;">消息队列</a> <a href="/willis-blog/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/willis-blog/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/willis-blog/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/willis-blog/tags/%E5%8E%8B%E7%BC%A9%E8%A1%A8/" style="font-size: 15px;">压缩表</a> <a href="/willis-blog/tags/%E5%BF%AB%E8%A1%A8/" style="font-size: 15px;">快表</a> <a href="/willis-blog/tags/%E8%B7%B3%E8%A1%A8/" style="font-size: 15px;">跳表</a> <a href="/willis-blog/tags/ThreadPool/" style="font-size: 15px;">ThreadPool</a> <a href="/willis-blog/tags/%E6%BA%90%E7%A0%81/" style="font-size: 15px;">源码</a> <a href="/willis-blog/tags/%E8%BF%9B%E7%A8%8B/" style="font-size: 15px;">进程</a> <a href="/willis-blog/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">线程</a> <a href="/willis-blog/tags/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/" style="font-size: 15px;">共享内存</a> <a href="/willis-blog/tags/%E5%86%85%E5%AD%98/" style="font-size: 15px;">内存</a> <a href="/willis-blog/tags/netty/" style="font-size: 15px;">netty</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/11/01/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%BA%90%E7%A0%81/">线程池源码</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/10/23/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3/">Redis数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/10/22/%E5%85%B3%E4%BA%8EJVM%E6%8C%87%E9%92%88%E5%8E%8B%E7%BC%A9/">关于JVM指针压缩</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/10/22/JVM%E5%90%8C%E6%AD%A5%E6%94%AF%E6%92%91/">JVM的同步支撑</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/10/14/Netty%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E4%B8%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Netty实现原理与源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/10/10/IO%E7%9A%84%E8%BF%9B%E5%8C%96/">IO的进化过程</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/09/25/Nginx-%E9%85%8D%E7%BD%AE/">Nginx-配置</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/08/04/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-kafka-1/">消息队列-kafka-1</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/06/19/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">操作系统-内存管理</a></li><li class="post-list-item"><a class="post-list-link" href="/willis-blog/2021/06/03/Maven%E7%9A%84docker%E6%8F%92%E4%BB%B6/">Maven的Docker插件</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.baidu.com/" title="百度" target="_blank">百度</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/willis-blog/." rel="nofollow">Willis's Note.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/willis-blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/willis-blog/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/willis-blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/willis-blog/js/smartresize.js?v=1.0.0"></script></div></body></html>